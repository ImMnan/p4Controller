#apiVersion: v1
#kind: PersistentVolumeClaim
#metadata:
#  name: btree-claim
#  namespace: p4
#spec:
#  accessModes:
#    - ReadWriteOnce
#  resources:
#    requests: 
#      storage: 2Gi
#  storageClassName: standard
#
#---
apiVersion: v1
kind: Service
metadata:
  name: p4d-svc
  labels:
    app: p4d
  namespace: p4
spec:
  type: LoadBalancer
  ports:
  - port: 4232
    name: p4d-port
    targetPort: 4232
  selector:
    app: p4d
    server: master
  externalTrafficPolicy: Local

---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: p4d-state
  namespace: p4
spec:
  selector:
    matchLabels:
      app: p4d # has to match .spec.template.metadata.labels
      server: master
  serviceName: "p4d-svc"
  replicas: 1 # by default is 1
  minReadySeconds: 10 # by default is 0,
  template:
    metadata:
      labels:
        app: p4d # has to match .spec.selector.matchLabels
        server: master
    spec:
      terminationGracePeriodSeconds: 5
      containers:
      - name: p4d-ctr
        image: immnan/p4d:0.1.6
        imagePullPolicy: Always
        ports:
        - containerPort: 4232
          name: p4d-port
        volumeMounts:
        - name: btree
          mountPath: /var/p4d-root/
        - name: checkpoint
          mountPath: /var/checkpoint/
        - name: version-files
          mountPath: /var/version-files/
      volumes:
      - name: btree
        emptyDir: {}
      - name: checkpoint
        emptyDir: {}
      - name: version-files
        emptyDir: {}
